---
title: ç”¨æˆ·è®¤è¯ç³»ç»Ÿé›†æˆ
weight: 20
---


{{% notice tip %}}
æ‚¨å¥½ï¼Œæœ¬ç« ä¸»è¦è®²è§£ä¸jenkinsä¸ç”¨æˆ·è®¤è¯ç³»ç»Ÿé›†æˆ ä¾‹å¦‚ï¼šLDAP Gitlab GitHub ã€‚æˆ‘ä»¬åšå®éªŒçš„è¿‡ç¨‹ä¸­å»ºè®®å…ˆå¼€å¯åŒ¿åæ¨¡å¼ï¼Œé˜²æ­¢é…ç½®é”™è¯¯å¯¼è‡´æ— æ³•ç›´æ¥ç™»å½•ã€‚ ğŸ˜€
{{% /notice %}}



### ç›®å½•

+ [ldapç³»ç»Ÿé›†æˆ](#ldapç³»ç»Ÿé›†æˆ)
+ [gitlabå•ç‚¹ç™»å½•](#gitlabå•ç‚¹ç™»å½•)
  - [gitlabé…ç½®](#gitlabé…ç½®)
  - [jenkinsé…ç½®](#jenkinsé…ç½®)
+ [githubå•ç‚¹ç™»å½•](#githubå•ç‚¹ç™»å½•)
  - [githubé…ç½®](#githubé…ç½®)
  - [é…ç½®jenkins](#é…ç½®jenkins)

---

Jenkinsé»˜è®¤ä½¿ç”¨è‡ªå¸¦æ•°æ®åº“æ¨¡å¼å­˜å‚¨ç”¨æˆ·ï¼Œåœ¨ä¼ä¸šä¸­ä¸€èˆ¬éƒ½ä¼šæœ‰ç»Ÿä¸€çš„è®¤è¯ä¸­å¿ƒï¼Œä¾‹å¦‚ LDAPã€ActiveDirectoryä¸­ç®¡ç†ç”¨æˆ·ã€‚å¯ä»¥é…ç½®Jenkinsé›†æˆå®ç°ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ã€‚

### ldapç³»ç»Ÿé›†æˆ

LDAPç³»ç»Ÿæ˜¯ç”¨äºç”¨æˆ·ç®¡ç†ï¼Œåœ¨é…ç½®é›†æˆçš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦ä»¥ä¸‹ä¿¡æ¯ï¼š

* æœåŠ¡å™¨åœ°å€ï¼š ldap://192.168.1.200
* æœåŠ¡å™¨ç«¯å£: 389
* ç»„ç»‡OU: ou=jenkins,dc=devops,dc=com
* ç®¡ç†å‘˜è´¦å·å’Œå¯†ç : cn=admin,dc=devops,dc=com

é¦–å…ˆï¼Œæˆ‘éœ€è¦åœ¨Jenkinsç³»ç»Ÿä¸­å®‰è£…`LDAP`æ’ä»¶ï¼Œç„¶åè¿›å…¥ ç³»ç»Ÿç®¡ç† -> `å…¨å±€å®‰å…¨é…ç½®`é¡µé¢ä¸­ã€‚

![images](images/01.png)

å¡«å†™å¥½ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»æµ‹è¯•æŒ‰é’®è¿›è¡Œæµ‹è¯•ã€‚ä¼šæ¨¡æ‹Ÿç”¨æˆ·ç™»å½•ï¼ŒæˆåŠŸåå†ä¿å­˜é…ç½®å³å¯ã€‚

![images](images/02.png)



### gitlabå•ç‚¹ç™»å½•
ä¸€èˆ¬æˆ‘ä»¬ä¼šé…ç½®Gitlabç³»ç»Ÿä¸LDAPç³»ç»Ÿåšç”¨æˆ·è®¤è¯é›†æˆï¼Œå¼€å‘äººå‘˜ç™»å½•gitlabç³»ç»Ÿçš„é¢‘ç‡è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä»Šå¤©æˆ‘ä»¬çš„é…ç½®æ•ˆæœæ˜¯ï¼šå½“ç”¨æˆ·å·²ç»ç™»å½•äº†gitlabï¼Œå†æ¬¡æ‰“å¼€Jenkinsä¼šè‡ªåŠ¨ç™»å…¥ã€‚


#### gitlabé…ç½®
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨Gitlabä¸­æ·»åŠ ä¸€ä¸ªåº”ç”¨ã€‚ç³»ç»Ÿè®¾ç½® -> åº”ç”¨ç®¡ç†

å¡«å†™Jenkinså›è°ƒåœ°å€`http://jenkinsserver:8080/securityRealm/finishLogin`,å‹¾é€‰æƒé™é»˜è®¤å…·æœ‰`read_user`æƒé™å³å¯ã€‚

![images](images/03.png)

ä¿å­˜é…ç½®ï¼Œä¼šæç¤ºä»¥ä¸‹ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦å¡«å†™åˆ°Jenkinsä¸­ã€‚`ApplicationId` `secret`
![images](images/04.png)

#### jenkinsé…ç½®

æˆ‘ä»¬éœ€è¦åœ¨Jenkinsç³»ç»Ÿä¸­å®‰è£…æ’ä»¶`Gitlab Authentication`ï¼Œ ç„¶åå¯¼èˆªåˆ°`å…¨å±€å®‰å…¨é…ç½®`ã€‚
å¡«å†™Gitlabç³»ç»Ÿåœ°å€å’Œä¸Šé¢åœ¨Gitlabåˆ›å»ºçš„åº”ç”¨çš„`ApplicationId` `secret`ã€‚
![images](images/05.png)


{{% notice info %}}
æ³¨æ„ï¼šå½“Jenkinså‰é¢æœ‰ä»£ç†çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°è·³è½¬é”™è¯¯çš„é—®é¢˜ã€‚è¿™æ—¶å€™éœ€è¦çœ‹ä¸‹æç¤ºé”™è¯¯çš„redirect URLåœ°å€,æ£€æŸ¥ä¸‹å›¾é…ç½®ã€‚ å¦‚æœä¸‹å›¾é…ç½®æ²¡æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä»£ç†çš„é…ç½®é—®é¢˜ã€‚å¦å¤–è¦æ³¨æ„æ˜¯`http`æ¨¡å¼å“¦
{{% /notice %}}
![images](images/06.png)


### githubå•ç‚¹ç™»å½•
å¦‚æœä½ ç”¨è¿‡GitLabï¼Œä½ ä¼šå‘ç°ä¸GitHubå¾ˆç±»ä¼¼ã€‚è¿™é‡Œæˆ‘ä»¬è¦é…ç½®çš„GitHubé›†æˆä¸GitLabé…ç½®å¾ˆç±»ä¼¼ã€‚


#### githubé…ç½®
é¦–å…ˆç™»å½•GitHub, settings -> Developer Settings -> Oauth Appsã€‚ 
![images](images/07.png)

æ–°å»ºåº”ç”¨ï¼šå¡«å†™Jenkinså›è°ƒåœ°å€`http://jenkinsserver:8080/securityRealm/finishLogin`ã€‚
![images](images/08.png)

ä¿å­˜ï¼Œè·å–åº”ç”¨IDå’Œsecret
![images](images/09.png)


#### é…ç½®jenkins
æˆ‘ä»¬éœ€è¦åœ¨Jenkinsç³»ç»Ÿä¸­å®‰è£…æ’ä»¶`Github Authentication`ï¼Œ ç„¶åå¯¼èˆªåˆ°`å…¨å±€å®‰å…¨é…ç½®`ã€‚
å¡«å†™Gitlabç³»ç»Ÿåœ°å€å’Œä¸Šé¢åœ¨Gitlabåˆ›å»ºçš„åº”ç”¨çš„`ApplicationId` `secret`ã€‚

![images](images/10.png)


æ•ˆæœï¼š
![images](images/11.png)

---

