---
title: Jenkinså…±äº«åº“åº”ç”¨
weight: 25
---


{{% notice tip %}}
æ‚¨å¥½ï¼Œæœ¬æ¨¡å—ä¸»è¦å­¦ä¹ Jenkinså…±äº«åº“çš„é…ç½®ï¼Œç›®çš„æ˜¯èƒ½å¤Ÿè®©å¤§å®¶ç¼–å†™æ›´åŠ çµæ´»å¼ºå¤§çš„æµæ°´çº¿ğŸ˜€
{{% /notice %}}

### ç›®å½•

+ [æ¦‚è¿°](#æ¦‚è¿°)
+ [å…±äº«åº“å†…å®¹](#å…±äº«åº“å†…å®¹)
+ [åˆ›å»ºå…±äº«åº“](#åˆ›å»ºå…±äº«åº“)
+ [ä½¿ç”¨å…±äº«åº“](#ä½¿ç”¨å…±äº«åº“)

---


### æ¦‚è¿°

å…±äº«åº“è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µï¼Œå…¶å®å…·æœ‰ç¼–ç¨‹èƒ½åŠ›çš„åŒå­¦åº”è¯¥æ¸…æ¥šä¸€äº›ã€‚ä¾‹å¦‚åœ¨ç¼–ç¨‹è¯­è¨€Pythonä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†Pythonä»£ç å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå½“ä»£ç æ•°é‡å¢åŠ ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç æ‰“åŒ…æˆæ¨¡å—ç„¶åå†ä»¥importçš„æ–¹å¼ä½¿ç”¨æ­¤æ¨¡å—ä¸­çš„æ–¹æ³•ã€‚

åœ¨Jenkinsä¸­ä½¿ç”¨Groovyè¯­æ³•ï¼Œå…±äº«åº“ä¸­å­˜å‚¨çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªgroovyçš„ç±»ï¼Œæ¯ä¸ªæ–‡ä»¶ï¼ˆç±»ï¼‰ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ã€‚æ¯ä¸ªæ–¹æ³•åŒ…å«groovyè¯­å¥å—ã€‚

æˆ‘æŠŠå…±äº«åº“ä»£ç ä¸Šä¼ åˆ°äº†githubï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ[demoå…±äº«åº“](https://github.com/zeyangli/jenkinslib)

### å…±äº«åº“å†…å®¹

è¿™æ˜¯ä¸€ä¸ªdemoæ¼”ç¤ºçš„å…±äº«åº“ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ä»“åº“çš„ç»“æ„ä¸å†…å®¹ã€‚è¿™ä¸ªä»“åº“ä¸­åŒ…å«äº†å¾ˆå¤šç±»ï¼Œä¾‹å¦‚ï¼šæˆ‘å°†kubernetesä¸­çš„APIæ–¹æ³•å°è£…åœ¨äº†kubernetes.groovyæ–‡ä»¶ä¸­ï¼Œä¾¿äºåé¢å¼•ç”¨ã€‚**åœ¨æ­¤ä½ åªéœ€è¦çŸ¥é“å…±äº«åº“çš„ç»“æ„
ï¼Œå…·ä½“è¯¥å¦‚ä½•åˆ›å»ºå…±äº«åº“åé¢ä¼šè®²è¿°ğŸ˜€**



```
â”€â”€ docs
â”‚Â Â  â””â”€â”€ README.mdREADME.md
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ org
â”‚Â Â      â””â”€â”€ devops
â”‚Â Â          â””â”€â”€ tools.groovy
â””â”€â”€ vars
```

srcç›®å½•ä¸»è¦å­˜æ”¾æˆ‘ä»¬è¦ç¼–å†™çš„groovyç±»ï¼Œæ‰§è¡Œæµæ°´çº¿æ—¶ï¼Œæ­¤ç›®å½•å°†æ·»åŠ åˆ°class_pathä¸­ã€‚
varsç›®å½•ä¸»è¦å­˜æ”¾è„šæœ¬æ–‡ä»¶ï¼Œè¿™äº›è„šæœ¬æ–‡ä»¶åœ¨æµæ°´çº¿ä¸­ä½œä¸ºå˜é‡å…¬å¼€ã€‚
resourcesç›®å½•å…è®¸ä»å¤–éƒ¨åº“ä¸­ä½¿ç”¨æ­¥éª¤æ¥åŠ è½½ç›¸å…³è”çš„éGroovyæ–‡ä»¶ã€‚


### åˆ›å»ºå…±äº«åº“

æ–°å»ºæ–‡ä»¶`src/org/devops/tools.groovy`, åœ¨æ­¤æˆ‘å°†è¿™ä¸ªæ–‡ä»¶å®šä¹‰ä¸ºæ‰©å±•å·¥å…·ç±»ï¼Œä¸»è¦æ”¾ä¸€äº›æ‰©å±•æ–¹æ³•ã€‚

ä¾‹å¦‚ï¼šåœ¨æ„å»ºæ—¥å¿—ä¸­æŸ¥çœ‹æµæ°´çº¿è¯¦ç»†æ—¥å¿—ä¼šå¾ˆä¹±ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—ä¸­å°†é‡ç‚¹æ­¥éª¤é€šè¿‡ä¸åŒçš„é¢œè‰²é«˜äº®æ˜¾ç¤ºï¼Œä¾¿äºæ’é”™ã€‚ æˆ‘ä»¬å¼€å§‹å†™è¿™æ ·çš„ä¸€ä¸ªæ–¹æ³•`PrintMes()`,åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œè¾“å‡ºå†…å®¹`value`å’Œå†…å®¹çš„é¢œè‰²`color`ã€‚


{{% notice info %}}
æ³¨æ„ï¼š æˆ‘ä»¬éœ€è¦å®‰è£… æ’ä»¶`AnsiColor`ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ansiColor()æ–¹æ³•ï¼Œå¯ä»¥åœ¨`ç‰‡æ®µç”Ÿæˆå™¨`æŸ¥çœ‹æ›´å¤šçš„ç”¨æ³•ã€‚
{{% /notice %}}

```
package org.devops

//æ ¼å¼åŒ–è¾“å‡º
def PrintMes(value,color){
    colors = ['red'   : "\033[40;31m >>>>>>>>>>>${value}<<<<<<<<<<< \033[0m",
              'blue'  : "\033[47;34m ${value} \033[0m",
              'green' : "[1;32m>>>>>>>>>>${value}>>>>>>>>>>[m",
              'green1' : "\033[40;32m >>>>>>>>>>>${value}<<<<<<<<<<< \033[0m" ]
    ansiColor('xterm') {
        println(colors[color])
    }
}
```

### ä½¿ç”¨å…±äº«åº“

æˆ‘ä»¬å¯¼èˆªåˆ° ç³»ç»Ÿé…ç½® ->  `Global Pipeline Libraries`

é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºå…±äº«åº“è®¾ç½®ä¸€ä¸ªåç§°`jenkinslib`ï¼Œæ³¨æ„è¿™ä¸ªåç§°åç»­åœ¨Jenkinsfileä¸­å¼•ç”¨ã€‚ å†è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œçš„ç‰ˆæœ¬æ˜¯åˆ†æ”¯çš„åç§°ã€‚æˆ‘é»˜è®¤é…ç½®çš„æ˜¯`master`ç‰ˆæœ¬ã€‚
![images](images/02.png)

æ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®å…±äº«åº“çš„ä»“åº“åœ°å€ï¼Œæˆ‘çš„ä»“åº“åœ¨githubä¸­ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å¡«å†™çš„æ˜¯githubçš„æ–¹å¼ã€‚ï¼ˆå¦‚æœä½ ç”¨çš„æ˜¯gitlabå¯ä»¥ä½¿ç”¨gitlabæ–¹å¼æˆ–è€…gitæ–¹å¼ï¼‰ã€‚å¦‚æœä»“åº“æ˜¯ç§æœ‰çš„æ–¹å¼ï¼Œéœ€è¦åœ¨jenkinsçš„å‡­æ®ä¸­æ·»åŠ ä¸€ä¸ªè´¦å·ç”¨äºä¸‹è½½å…±äº«åº“ã€‚
![images](images/03.png)


å¥½ï¼Œåˆ°æ­¤å…±äº«åº“åœ¨Jenkinsçš„é…ç½®å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æµ‹è¯•åœ¨Jenkinsfileä¸­å¼•ç”¨ã€‚

åœ¨Jenkinsfileä¸­ä½¿ç”¨`@Library('jenkinslib') _ `æ¥åŠ è½½å…±äº«åº“ï¼Œæ³¨æ„åé¢ç¬¦å·`_`ç”¨äºåŠ è½½ã€‚ 
ç±»çš„å®ä¾‹åŒ–`def tools = new org.devops.tools()`,ä½¿ç”¨ç±»ä¸­çš„æ–¹æ³•`tools.PrintMes("è·å–ä»£ç ",'green')`ã€‚


{{% notice tip %}}
è¿™é‡Œä½¿ç”¨`def tools = new org.devops.tools()` ä¼šå‡ºç°å‘½åå†²çªé—®é¢˜ï¼Œéœ€è¦æ”¹æˆå…¶ä»–åç§°ã€‚
{{% /notice %}}


```Jenkinsfile
#!groovy

@Library('jenkinslib') _     

def mytools = new org.devops.tools()



pipeline {
    agent { node {  label "master" }}

    stages {
        //ä¸‹è½½ä»£ç 
        stage("GetCode"){ 
            steps{  
                timeout(time:5, unit:"MINUTES"){   
                    script{ 
                        mytools.PrintMes("è·å–ä»£ç ",'green')
                    }
                }
            }
        }
    }
}

```


æ¥ä¸‹æ¥åœ¨ä½ çš„Jenkinsä¸Šé¢è¿è¡Œä¸€ä¸‹å§ï¼Œæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿçœ‹åˆ°å¸¦æœ‰ç»¿è‰²çš„æ–‡å­—å‘¢ï¼Ÿ
